#!/usr/bin/env bash

set -euo pipefail

R_BINARY_LOCATION=https://github.com/dvulpe/r-buildpack/releases/download/v0.1.0/R-3.4.2.tar.gz

BUILD_DIR=$1
CACHE_DIR=$2

export DEPS_DIR="$BUILD_DIR/.cloudfoundry"
mkdir -p "$DEPS_DIR/0"
mkdir -p "$BUILD_DIR/.profile.d"

WORKDIR=$PWD
echo "Current folder ${WORKDIR}"

cd $BUILD_DIR

echo "Downloading R 3.4.2 binaries"
time {
    curl -sS -L -o $CACHE_DIR/R-3.4.2.tar.gz $R_BINARY_LOCATION
}
echo "Decompressing R-3.4.2 binaries"
time {
    tar -zxf $CACHE_DIR/R-3.4.2.tar.gz
}

cd $WORKDIR
